<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Secure Link</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg-color: var(--tg-theme-bg-color, #ffffff);
            --text-color: var(--tg-theme-text-color, #000000);
            --btn-color: var(--tg-theme-button-color, #3390ec);
            --btn-text: var(--tg-theme-button-text-color, #ffffff);
            --disabled-color: #a0a0a0;
            --success-color: #28a745;
        }
        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
        }
        .card { padding: 20px; text-align: center; max-width: 320px; width: 90%; }
        
        h2 { margin-bottom: 5px; }
        
        .instructions { 
            background: rgba(255, 193, 7, 0.2); 
            color: #d68b00; 
            padding: 10px; 
            border-radius: 8px;
            font-size: 13px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 193, 7, 0.3);
        }

        .btn {
            border: none;
            padding: 16px;
            font-size: 16px;
            font-weight: bold;
            border-radius: 12px;
            cursor: pointer;
            width: 100%;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        /* Button 1: Ad Unlock */
        #btn1 {
            background-color: var(--btn-color);
            color: var(--btn-text);
        }

        /* Button 2: Content (Initially Disabled) */
        #btn2 {
            background-color: #e0e0e0; /* Gray */
            color: #888;
            pointer-events: none; /* Not clickable yet */
        }

        /* Active State for Button 2 */
        #btn2.active {
            background-color: var(--success-color);
            color: white;
            pointer-events: auto; /* Now clickable */
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
        }

        /* Completed State for Button 1 */
        #btn1.completed {
            background-color: #e0e0e0;
            color: #888;
            text-decoration: line-through;
        }

    </style>
</head>
<body>

    <div class="card">
        <h2>Content Locked</h2>
        
        <!-- INSTRUCTION BOX -->
        <div class="instructions">
            ‚ö†Ô∏è <strong>Instruction:</strong> Tap Step 1 to open the sponsor. Return here to enable Step 2.
        </div>

        <!-- BUTTON 1: THE AD -->
        <button class="btn" id="btn1">üîì Step 1: Unlock Link</button>

        <!-- BUTTON 2: THE CONTENT -->
        <button class="btn" id="btn2">üìÑ Step 2: Read Article</button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // ‚¨áÔ∏è PASTE YOUR MONETAG DIRECT LINK HERE ‚¨áÔ∏è
        const directAdLink = "https://ey43.com/4/10352740"; 

        const urlParams = new URLSearchParams(window.location.search);
        const destination = urlParams.get('link');
        const btn1 = document.getElementById('btn1');
        const btn2 = document.getElementById('btn2');

        // Check if already unlocked in this session
        if (localStorage.getItem(destination) === 'true') {
            activateStep2();
        }

        // --- STEP 1 CLICK (AD) ---
        btn1.addEventListener('click', () => {
            if (!destination) return;

            // 1. Open Ad
            tg.openLink(directAdLink);
            
            // 2. Unlock Step 2 immediately (so it's ready when they return)
            activateStep2();
            
            // 3. Save state
            localStorage.setItem(destination, 'true');
        });

        // --- STEP 2 CLICK (CONTENT) ---
        btn2.addEventListener('click', () => {
            if (destination) {
                tg.openLink(destination);
            }
        });

        function activateStep2() {
            // Visual changes
            btn1.classList.add('completed');
            btn1.innerText = "‚úÖ Step 1: Unlocked";
            
            btn2.classList.add('active');
            btn2.innerText = "üöÄ Step 2: Open Article";
        }
    </script>
</body>
</html>
